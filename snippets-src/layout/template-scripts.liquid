{% case template %}
  {% when 'index' %}
    <script defer type="module" src="{{ 'built-home.js' | asset_url }}"></script>
    <script type="module" src="{{ 'built-product-tile.js' | asset_url }}"></script>
    <script type="module" src="{{ 'built-product-carousel.js' | asset_url }}"></script>
  {% when 'product' %}
    {% if product.metafields.global.features == blank %}
    {% else %}
      {% comment %} Modern Product Page {% endcomment %}
      {% comment %}
        Store Pickup Script(s)
        @TODO Install as npm packages. With the current rollup configuration,
        'moment-timezone.js' throws an error, requiring the use of 'rollup-plugin-json'.
        @see https://github.com/decathlon-usa/shopify-theme-decathlonusa/pull/441#discussion_r290511357
      {% endcomment %}
      {% include 'moment.js' %}
      {% include 'moment-timezone.js' %}
      <script>
        window.firstVariant = {{ product.selected_or_first_available_variant | json }};
        window.testVariant = {{ product.selected_or_first_available_variant.inventory_quantity | json }};
        {% comment %} Oversell threshold {% endcomment %}
        {% if product.metafields.my_fields.oversell_threshold %}
          window.productOversellThreshold = {{ product.metafields.my_fields.oversell_threshold }};
        {% else %}
          window.productOversellThreshold = {{ settings.global_oversell_threshold }};
        {% endif %}
        {% comment %} 
          Create a new JS variant array that has a inventory_quantity
          as for some reason Shopify doesn't populate the inventory_quantity field automatically with JSON filter
          See post: https://community.shopify.com/c/shopify-apis-and-sdks/why-would-product-variants-be-missing-the-inventory-policy-field/td-p/1153789

          Also it seems that this object `window.tomitProductInventoryInfo.activeProduct.variants` 
          `inventoryItem.available` field always returns 0 even though the quantity is below 0
        {% endcomment %}
        window.variantsWithInventoryQuantity = [];
        {% for variant in product.variants %}
          var variant = {{ variant | json }};
          variant.inventory_quantity = {{ variant.inventory_quantity | json }};
          window.variantsWithInventoryQuantity.push(variant);
        {% endfor %}
      </script>
      <script defer type="module" src="{{ 'built-product-page.js' | asset_url }}"></script>
    {% endif %}
    <script type="module" src="{{ 'built-product-carousel.js' | asset_url }}"></script>
    <script type="module" src="{{ 'built-product-tile.js' | asset_url }}"></script>
  {% when 'customers/account' %}
    {% if settings.extra_details == 'customer_fields' %}
      <script defer type="module" src="{{ 'built-customer-fields.js' | asset_url }}"></script>
    {% endif %}
  {% when 'cart' %}
    <script defer type="module" src="{{ 'built-cart-page.js' | asset_url }}"></script>
    <script defer nomodule src="{{ 'built-cart-page.js' | asset_url }}"></script>
    <script type="module" src="{{ 'built-product-tile.js' | asset_url }}"></script>
    <script type="module" src="{{ 'built-product-carousel.js' | asset_url }}"></script>
  {% when 'collection' %}
    <script defer src="{{ 'built-collection-page.js' | asset_url }}"></script>
    {% if settings.show_recently_viewed_carousel_on_collection_page %}
      <script type="module" src="{{ 'built-product-carousel.js' | asset_url }}"></script>
      <script type="module" src="{{ 'built-product-tile.js' | asset_url }}"></script>
      <script type="module" src="{{ 'built-init-recently-viewed.js' | asset_url }}"></script>
    {% endif %}
  {% when 'search' %}
    {% if settings.show_recently_viewed_carousel_on_search_page %}
      <script type="module" src="{{ 'built-product-carousel.js' | asset_url }}"></script>
      <script type="module" src="{{ 'built-product-tile.js' | asset_url }}"></script>
      <script type="module" src="{{ 'built-init-recently-viewed.js' | asset_url }}"></script>
    {% endif %}
{% endcase %}


<script defer type="module" src="{{ 'built-global.js' | asset_url }}"></script>
