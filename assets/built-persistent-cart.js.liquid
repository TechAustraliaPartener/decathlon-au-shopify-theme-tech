import{I as t,s as e,D as r}from"./built-fetch-stores-13903880.js";import{C as n,c as o,_ as i}from"./built-toConsumableArray-0fbe23f7.js";import{r as u,b as a,c,d as s,e as f,s as l,l as h,f as p}from"./built-storage-f11703b1.js";function d(t,e){return e||(e=t.slice(0)),t.raw=e,t}var m=/(query|mutation) ?([\w\d-_]+)? ?\(.*?\)? \{/;function y(t){var e=Array.isArray(t)?t.join(""):t,r=m.exec(e);return function(t){var n={query:e};return t&&(n.variables=t),Array.isArray(r)&&r[2]&&r[2]&&(n.operationName=r[2]),JSON.stringify(n)}}var v=["www.decathlon.com"],b=["testing-decathlon-usa.myshopify.com"],g={get API_URL(){var t="http://localhost:8080",e=window.location.hostname;return b.some((function(t){return e.match(RegExp(t))}))&&(t="https://persistent-cart-decathlonusa-s.herokuapp.com"),v.some((function(t){return e.match(RegExp(t))}))&&(t="https://persistent-cart-decathlonusa-p.herokuapp.com"),t+"/shopify/graphql"},STORAGE:{PREFIX:"de_pc_",get SHOPIFY_CART(){return this.PREFIX+"shopify_cart"},get LOGGED_IN(){return this.PREFIX+"logged_in"}},SHOPIFY_API:{GET_CART:"/cart.js",UPDATE_CART:"/cart/update.js",ADD_TO_CART:"/cart/add.js"},COOKIES:{CART:"cart",CART_TS:"cart_ts",CART_SIG:"cart_sig",CART_CURRENCY:"cart_currency"},get ALL_CART_COOKIES(){var t=this;return Object.keys(this.COOKIES).map((function(e){return t.COOKIES[e]}))},get CART_COOKIE(){return this.COOKIES.CART}},w=e.STOREFRONT_API,C=e.NO_CACHE_HEADERS,I=function(t,e,r,n){return void 0===n&&(n={}),function(t,e,r,n){return void 0===n&&(n={}),fetch(r||g.API_URL,{body:t(e),method:"POST",headers:Object.assign({"Content-Type":"application/json",Accept:"application/json"},n.headers)}).then((function(t){if(!t.ok){var e=t.statusText;throw Error("Failed GQL request. Status: "+t.status+(e&&"; message: "+e))}return t.json()})).then((function(t){var e=t.data,r=t.errors;if(r){var n=r.reduce((function(t,e,r){return t+(r>0?", ":"")+e.message}),"");console.info("PC: ",n)}return e}))}(t,e,r,{headers:Object.assign({},C,n.headers)})},E=function(t,e){var r={};return r[w.HEADER_NAME]=w.KEY,I(t,e,w.URL,{headers:r})};function S(){var t=d(["\n  query($customerID: ID!) {\n    getCustomer(customerID: $customerID) {\n      customerID\n      cart\n      cartID\n    }\n  }\n"]);return S=function(){return t},t}function O(){var t=d(["\n  mutation($customerID: ID!, $cart: JSON) {\n    createOrUpdateCustomer(customerID: $customerID, cart: $cart) {\n      customerID\n      cart\n      cartID\n    }\n  }\n"]);return O=function(){return t},t}var D=g.API_URL,A=y(O()),_=y(S()),j=function(t){var e;return I((e={mutation:A,customerID:t.customerID,cart:t.cart}).mutation,{customerID:e.customerID,cart:e.cart},D).then((function(t){return t.createOrUpdateCustomer})).catch((function(t){throw Error("Error creating or updating customer in database: "+t.message)}))},T=g.STORAGE,R=T.LOGGED_IN,P=T.SHOPIFY_CART,x=function(){return a(P)},k=function(t){return c(P,t)},F=function(){return u(P)},q=function(){return c(R,!0)},L=function(){return!!a(R)},U={customerID:null,customer:null,masterShopifyCart:null,customerCartExpired:!1,currentCartCount:0,setNewCustomerOrCart:!1};function M(){var t=d(["\n  query testStorefrontAPIQuery {\n    shop {\n      name\n    }\n  }\n"]);return M=function(){return t},t}function N(){var t=d(["\n  mutation checkoutCreate($input: CheckoutCreateInput!) {\n    checkoutCreate(input: $input) {\n      checkout {\n        id\n        webUrl\n      }\n      checkoutUserErrors {\n        code\n        field\n        message\n      }\n    }\n  }\n"]);return N=function(){return t},t}var H,B,G=y(N()),K=y(M()),X=function(t){return E((e={mutation:G,input:t}).mutation,{input:e.input}).then((function(t){return t.checkoutCreate})).catch((function(t){throw Error("Error getting customer from database: "+t.message)}));var e},$=function(t){return t.map((function(t){return{id:t.variant_id,quantity:t.quantity}}))},Y=function(t){return t&&(t.items||t.line_items)||[]},J=g.CART_COOKIE,z=function(t){return n.set(J,t)},Q=n.get(J),V=function(){return n.remove(J)},W=Object.prototype,Z=Function.prototype.toString,tt=W.hasOwnProperty,et=Z.call(Object),rt=W.toString,nt=(H=Object.getPrototypeOf,B=Object,function(t){return H(B(t))}),ot=function(t){if(!function(t){return!!t&&"object"==typeof t}(t)||"[object Object]"!=rt.call(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t))return!1;var e=nt(t);if(null===e)return!0;var r=tt.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Z.call(r)==et},it=function(t){var e=document.querySelector(".js-cart-count");e&&(e.innerText=t)},ut=e.SELECTORS.LOGOUT,at=function(){V()};!function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var r,n="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,r){return t==Array.prototype||t==Object.prototype||(t[e]=r.value),t},i=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof o&&o];for(var e=0;e<t.length;++e){var r=t[e];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function u(t,e){if(e){for(var r=i,o=t.split("."),u=0;u<o.length-1;u++){var a=o[u];a in r||(r[a]={}),r=r[a]}(a=e(u=r[o=o[o.length-1]]))!=u&&null!=a&&n(r,o,{configurable:!0,writable:!0,value:a})}}function a(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function c(t){var r="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return r?r.call(t):{next:e(t)}}if(u("Symbol",(function(t){function e(t,e){this.o=t,n(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.o};var r=0;return function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e("jscomp_symbol_"+(n||"")+"_"+r++,n)}})),u("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var r="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),o=0;o<10;o++){var u=i[r[o]];"function"==typeof u&&"function"!=typeof u.prototype[t]&&n(u.prototype,t,{configurable:!0,writable:!0,value:function(){return a(e(this))}})}return t})),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var s;t:{var f={};try{f.__proto__={u:!0},s=f.u;break t}catch(t){}s=!1}r=s?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var l=r;function h(){this.h=!1,this.f=null,this.m=void 0,this.b=1,this.l=this.v=0,this.g=null}function p(t){if(t.h)throw new TypeError("Generator is already running");t.h=!0}function d(t,e){return t.b=3,{value:e}}function m(t){this.a=new h,this.B=t}function y(t,e,r,n){try{var o=e.call(t.a.f,r);if(!(o instanceof Object))throw new TypeError("Iterator result "+o+" is not an object");if(!o.done)return t.a.h=!1,o;var i=o.value}catch(e){return t.a.f=null,t.a.j(e),v(t)}return t.a.f=null,n.call(t.a,i),v(t)}function v(t){for(;t.a.b;)try{var e=t.B(t.a);if(e)return t.a.h=!1,{value:e.value,done:!1}}catch(e){t.a.m=void 0,t.a.j(e)}if(t.a.h=!1,t.a.g){if(e=t.a.g,t.a.g=null,e.A)throw e.w;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function b(t){this.next=function(e){return t.i(e)},this.throw=function(e){return t.j(e)},this.return=function(e){return function(t,e){p(t.a);var r=t.a.f;return r?y(t,"return"in r?r.return:function(t){return{value:t,done:!0}},e,t.a.return):(t.a.return(e),v(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function g(t,e){var r=new b(new m(e));return l&&l(r,t.prototype),r}if(h.prototype.i=function(t){this.m=t},h.prototype.j=function(t){this.g={w:t,A:!0},this.b=this.v||this.l},h.prototype.return=function(t){this.g={return:t},this.b=this.l},m.prototype.i=function(t){return p(this.a),this.a.f?y(this,this.a.f.next,t,this.a.i):(this.a.i(t),v(this))},m.prototype.j=function(t){return p(this.a),this.a.f?y(this,this.a.f.throw,t,this.a.i):(this.a.j(t),v(this))},"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var w=function(t,e){for(var r=0;r<t.length;r++)e(t[r])},C=function(t,e,r){return e instanceof Blob?[t+"",e,void 0!==r?r+"":"string"==typeof e.name?e.name:"blob"]:[t+"",e+""]},I=function(t,e){if(t.length<e)throw new TypeError(e+" argument required, but only "+t.length+" present.")},E=function(t){var e=c(t);t=e.next().value;var r=e.next().value;return e=e.next().value,r instanceof Blob&&(r=new File([r],e,{type:r.type,lastModified:r.lastModified})),[t,r]},S="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,O=S.FormData,D=S.XMLHttpRequest&&S.XMLHttpRequest.prototype.send,A=S.Request&&S.fetch,_=S.navigator&&S.navigator.sendBeacon,j=S.Element&&S.Element.prototype,T=S.Symbol&&Symbol.toStringTag;T&&(Blob.prototype[T]||(Blob.prototype[T]="Blob"),"File"in S&&!File.prototype[T]&&(File.prototype[T]="File"));try{new File([],"")}catch(t){S.File=function(t,e,r){return t=new Blob(t,r),Object.defineProperties(t,{name:{value:e},lastModifiedDate:{value:r=r&&void 0!==r.lastModified?new Date(r.lastModified):new Date},lastModified:{value:+r},toString:{value:function(){return"[object File]"}}}),T&&Object.defineProperty(t,T,{value:"File"}),t}}var R=function(t){this.c=[];var e=this;t&&w(t.elements,(function(t){if(t.name&&!t.disabled&&"submit"!==t.type&&"button"!==t.type&&!t.matches("form fieldset[disabled] *"))if("file"===t.type){var r=t.files&&t.files.length?t.files:[new File([],"",{type:"application/octet-stream"})];w(r,(function(r){e.append(t.name,r)}))}else"select-multiple"===t.type||"select-one"===t.type?w(t.options,(function(r){!r.disabled&&r.selected&&e.append(t.name,r.value)})):"checkbox"===t.type||"radio"===t.type?t.checked&&e.append(t.name,t.value):(r="textarea"===t.type?t.value.replace(/\r\n/g,"\n").replace(/\n/g,"\r\n"):t.value,e.append(t.name,r))}))};if((t=R.prototype).append=function(t,e,r){I(arguments,2),this.c.push(C(t,e,r))},t.delete=function(t){I(arguments,1);var e=[];t+="",w(this.c,(function(r){r[0]!==t&&e.push(r)})),this.c=e},t.entries=function t(){var e,r=this;return g(t,(function(t){if(1==t.b&&(e=0),3!=t.b)return e<r.c.length?t=d(t,E(r.c[e])):(t.b=0,t=void 0),t;e++,t.b=2}))},t.forEach=function(t,e){I(arguments,1);for(var r=c(this),n=r.next();!n.done;n=r.next()){var o=c(n.value);n=o.next().value,o=o.next().value,t.call(e,o,n,this)}},t.get=function(t){I(arguments,1);var e=this.c;t+="";for(var r=0;r<e.length;r++)if(e[r][0]===t)return E(e[r])[1];return null},t.getAll=function(t){I(arguments,1);var e=[];return t+="",w(this.c,(function(r){r[0]===t&&e.push(E(r)[1])})),e},t.has=function(t){I(arguments,1),t+="";for(var e=0;e<this.c.length;e++)if(this.c[e][0]===t)return!0;return!1},t.keys=function t(){var e,r,n=this;return g(t,(function(t){if(1==t.b&&(e=c(n),r=e.next()),3!=t.b)return r.done?void(t.b=0):d(t,c(r.value).next().value);r=e.next(),t.b=2}))},t.set=function(t,e,r){I(arguments,2);var n=[],o=C(t+="",e,r),i=!0;w(this.c,(function(e){e[0]===t?i&&(i=!n.push(o)):n.push(e)})),i&&n.push(o),this.c=n},t.values=function t(){var e,r,n,o=this;return g(t,(function(t){if(1==t.b&&(e=c(o),r=e.next()),3!=t.b)return r.done?void(t.b=0):((n=c(r.value)).next(),d(t,n.next().value));r=e.next(),t.b=2}))},R.prototype._asNative=function(){for(var t=new O,e=c(this),r=e.next();!r.done;r=e.next()){var n=c(r.value);r=n.next().value,n=n.next().value,t.append(r,n)}return t},R.prototype._blob=function(){for(var t="----formdata-polyfill-"+Math.random(),e=[],r=c(this),n=r.next();!n.done;n=r.next()){var o=c(n.value);n=o.next().value,o=o.next().value,e.push("--"+t+"\r\n"),o instanceof Blob?e.push('Content-Disposition: form-data; name="'+n+'"; filename="'+o.name+'"\r\nContent-Type: '+(o.type||"application/octet-stream")+"\r\n\r\n",o,"\r\n"):e.push('Content-Disposition: form-data; name="'+n+'"\r\n\r\n'+o+"\r\n")}return e.push("--"+t+"--"),new Blob(e,{type:"multipart/form-data; boundary="+t})},R.prototype[Symbol.iterator]=function(){return this.entries()},R.prototype.toString=function(){return"[object FormData]"},j&&!j.matches&&(j.matches=j.matchesSelector||j.mozMatchesSelector||j.msMatchesSelector||j.oMatchesSelector||j.webkitMatchesSelector||function(t){for(var e=(t=(this.document||this.ownerDocument).querySelectorAll(t)).length;0<=--e&&t.item(e)!==this;);return-1<e}),T&&(R.prototype[T]="FormData"),D){var P=S.XMLHttpRequest.prototype.setRequestHeader;S.XMLHttpRequest.prototype.setRequestHeader=function(t,e){P.call(this,t,e),"content-type"===t.toLowerCase()&&(this.s=!0)},S.XMLHttpRequest.prototype.send=function(t){t instanceof R?(t=t._blob(),this.s||this.setRequestHeader("Content-Type",t.type),D.call(this,t)):D.call(this,t)}}A&&(S.fetch=function(t,e){return e&&e.body&&e.body instanceof R&&(e.body=e.body._blob()),A.call(this,t,e)}),_&&(S.navigator.sendBeacon=function(t,e){return e instanceof R&&(e=e._asNative()),_.call(this,t,e)}),S.FormData=R}}();var ct=e.SELECTORS.CART,st=function(t){return t.items.map((function(t){return{quantity:t.quantity,variantId:btoa("gid://shopify/ProductVariant/"+t.variant_id)}}))},ft=function(t){return{lineItems:t}},lt=function(t){if(!t.ok)throw Error(t.statusText);return t},ht=function(e){e.preventDefault(),e.stopPropagation();var r=this.querySelectorAll('[name="updates[]"]'),n=i(r).filter((function(t){return parseInt(t.value,10)>0}));if(0===n.length)return window.location.reload(),!1;var o=document.createElement("form");n.forEach((function(t){return o.appendChild(t.cloneNode())})),fetch("/cart",{method:"POST",body:new FormData(o)}).then(lt).then((function(t){return t.json()})).then(st).then(ft).then(X).then((function(e){if(!e.checkout||!e.checkout.webUrl){var r=e.checkoutUserErrors,n=r?r.reduce((function(t,e){return t+", "+e.message}),""):"";throw Error("Error attempting to create custom checkout 🛒. "+n)}window.location.assign(e.checkout.webUrl+"&"+encodeURIComponent(t)+"=true")})).catch((function(t){console.error(t),window.location.reload()}))},pt=function(t){return"string"==typeof t.message?t.message:t},dt=g.SHOPIFY_API,mt=dt.GET_CART,yt=dt.UPDATE_CART,vt=dt.ADD_TO_CART,bt=e.SELECTORS,gt=bt.CART_COUNT,wt=bt.CUSTOMER_ID,Ct={headers:{"Content-Type":"application/json",pragma:"no-cache","cache-control":"no-cache"},method:"POST"},It=function(t){if(!t)throw Error("Cart not passed to handler for updating UI.");return k(t),it(t.item_count),t},Et=function(t){return new Promise((function(e,r){var n;return Promise.resolve(t.json()).then((function(o){try{return n=o,t.ok?e(n):n.description&&"cannot find variant"===n.description.toLowerCase()?r(Error("A product in the cart is invalid")):r(Error("Attempt to update or rebuild cart failed with error: "+n.message))}catch(t){return r(t)}}),r)}))},St=function(t){var e=Object.assign({},Ct,{body:JSON.stringify({id:t.id,quantity:t.quantity})});return fetch(vt,e).then(Et).catch((function(){return null}))},Ot=function(){var t=U.customer,e=x();if(U.customerCartExpired)return!0;if(!e||L())return!1;if(!t||!e.token)throw Error("Checking whether carts should be reconciled failed because\n      "+U.customerID+" or a Shopify cart ID could not be found.");return t&&t.cartID&&t.cartID!==e.token},Dt=function(t){void 0===t&&(t=x());var e=U.customer,r=t&&(!e||e&&!e.cartID);if(U.setNewCustomerOrCart=r,r)return j({customerID:U.customerID,cart:t}).then((function(t){return U.customer=t,e=t,!1}));if(e&&e.cartID)return!0;if(!t&&!e||e&&!e.cartID)return!1;throw Error("Customer "+U.customerID+" should already have been set in the database, but has not been.")},At=function(t){return t&&z(t),fetch(mt,{headers:{pragma:"no-cache","cache-control":"no-cache"}}).then((function(t){return t.json()})).then((function(e){if(!e)throw Error("Could not fetch a cart from Shopify with cartID "+(t||Q)+".");return e}))},_t=function(t){return t?k(t):F(),x()},jt=function(t){return U.customerCartExpired=t,t},Tt=function(t){return U.masterShopifyCart=t,t},Rt=function(t){return U.customer=t,(U.currentCartCount>0?At():Promise.resolve(null)).then(_t).then(Dt).then((function(t){return t?(((r=x())&&r.token?r.token:null)!==(U.customer&&U.customer.cartID?U.customer.cartID:null)?At(U.customer.cartID).then(Tt):Promise.resolve(x())).then((function(t){return e=t,void 0===(r=t)&&(r=U.masterShopifyCart),r&&r.token!==U.customer.cartID;var r})).then(jt).then(Ot).then((function(t){var r,n;return t?(r=x(),n=U.customerCartExpired?U.customer.cart:U.masterShopifyCart,function(t){if(void 0===t&&(t=null),!t)throw Error("modifyShopifyCart was called without a payload.");var e=U.customerCartExpired?U.masterShopifyCart.token:U.customer.cartID;if(!e)throw Error("Before updating the Shopify cart, there is no token to set.");return U.customerCartExpired&&z(e),function(t){var e=Object.assign({},Ct,{body:JSON.stringify({updates:t})});return fetch(yt,e).then(Et)}(t).catch((function(e){return console.error("/cart/update.js returned with error",e),function(t){var e,r;return(e=Object.keys(t).map((function(e){return{id:e,quantity:t[e]}})),r=St,e.reduce((function(t,e){return t.then((function(t){return r(e).then((function(e){return t.concat(e)}))}))}),Promise.resolve([]))).then((function(t){return At()}))}(t)})).then((function(r){if(r&&"item_count"in r)return k(r),r;throw Error("No cart returned after attempting to update or rebuild using token "+e+(t?", with reconciled carts: "+t:"")+".")}))}([].concat(i($(Y(r))),i($(Y(n)))).reduce((function(t,e){return t[e.id]=(t[e.id]||0)+e.quantity,t}),{})).then((function(t){return U.customerCartExpired?function(t){return void 0===t&&(t=x()),j({customerID:U.customer.customerID,cart:t}).then((function(t){return t.cart}))}(t):t})).then(It)):It(e)})):U.setNewCustomerOrCart?"A customer was just created or updated: ' "+U.customer.customerID:"There's no saved customer, or the saved customer has no cart, and the Shopify cart is empty, so ending";var e,r}))},Pt=function(){L()&&(V(),it(0)),u(R),F()},xt=function(t){t?F():Pt()};document.addEventListener("DOMContentLoaded",(function(){return new Promise((function(t,e){var n,o;return n=document.querySelector(wt),o=n&&n.value?n.value:null,l?Promise.resolve(new Promise((function(t,e){var r;if(null===(r=s()))return Promise.resolve(E(K).then((function(t){return!(!t.shop||!t.shop.name)})).catch((function(t){return console.error("Storefront API Test Request Failed:",t),!1}))).then(function(t){try{return f(r=t),n()}catch(t){return e(t)}}.bind(this),e);function n(){return t(r)}return n()}))).then(function(t){try{return t?(r&&console.debug("Shopify 🏬 Storefront API test succeeded"),document.addEventListener("submit",(function(t){for(var e=t.target;e&&e!==this;e=e.parentNode)if(e.matches(ct)){ht.call(e,t);break}})),function(t){var e,r=document.querySelector(gt);U.currentCartCount=parseInt(r.value,10),U.customerID=t,h&&p&&(U.customerID?I((e={query:_,customerID:U.customerID}).query,{customerID:e.customerID},D).then((function(t){return t.getCustomer})).catch((function(t){throw Error("Error getting customer from database: "+t.message)})).then((function(t){if(t&&("object"!=typeof t||"error"in t)){if("error"in t)throw Error(t.error)}else e=t,(r=document.querySelector(ut))&&r.addEventListener("click",at),Rt(e).then((function(t){if(t&&t.error)throw Error(pt(t.error));q()})).catch((function(t){q(),console.error("Persistent cart errors or messages: ",pt(t))})),function(t){var e=window.ShopifyAPI;if(e&&e.addItemFromForm){var r=function(e){return function(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];var i=n.find((function(t){return ot(t)&&"variant_id"in t&&"quantity"in t}));return i&&t(i.quantity),e.apply(void 0,n)}},n=e.addItemFromForm;e.addItemFromForm=function(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];var u=e.map((function(t){return"function"==typeof t?r(t):t}));return n.apply(void 0,i(u))}}}((function(t){U.currentCartCount+=t,Rt(e)}));var e,r})).catch((function(t){console.error("Persistent cart cannot be initialized",t),F()})):Pt())}(o)):(console.error("Shopify 🏬 Storefront API test failed"),xt(o)),u()}catch(t){return e(t)}}.bind(this),e):(console.error("Session storage test failed, cannot persist Storefront API\n    health check results"),xt(o),u());function u(){return t()}}))}));
