{% comment %}

  Rich snippets (itemscope, itemtype, etc.) for products are a theme requirement,
  and allow search engines to easily understand what the content is.

  For more information on these Scheme.org tags, visit:
    - http://schema.org/docs/gs.html

{% endcomment %}

{% include 'section-clips' %}

{% assign product_has_size_chart = false %}
{%- for tag in product.tags -%}
  {%- if tag contains 'Model Code: ' -%}
    {%- assign model_code_tag = tag | split: 'Model Code: ' -%}
    {%- assign model_code = model_code_tag[1] -%}
  {%- endif -%}
  {%- if tag contains 'Size Chart: ' -%}
    {% assign product_has_size_chart = true %}
  {%- endif -%}

{%- endfor -%}

{% if model_code == blank %}
  {% capture model_code %}{{ product.variants.first.option3 }}{% endcapture %}
{% endif %}

{% comment %}
  From existing Decathlon Product template END BLOCK 1
{% endcomment %}

{% comment %}
  From existing Decathlon Product template START BLOCK 2
{% endcomment %}
<div id="ProductWrap"
  class="timber-activeProduct {% if product.options.size < 2
  %}product-singleOption{% endif %}
  itemscope
  itemtype="http://schema.org/Product">

  <meta itemprop="url" content="{{ shop.url }}{{ product.url }}">
  <meta itemprop="image" content="{{ product.featured_image.src | img_url: 'grande' }}">

  {% comment %}
    Get first variant, or deep linked one
  {% endcomment %}
  {% assign current_variant = product.selected_or_first_available_variant %}

{% comment %}
  From existing Decathlon Product template END BLOCK 2
{% endcomment %}

    {% comment %}
      From existing Decathlon Product template START BLOCK 3
    {% endcomment %}
    <div class="de-Wrapper de-u-lg-spaceBottom3">

      {% include 'section-clips' %}

      {% comment %} Breadcrumbs {% endcomment %}
      <div class="de-u-hidden de-u-md-block">
        {% include 'breadcrumb' %}
      </div>

      <div class="de-u-lg-flex de-u-lg-flexJustifyBetween">
        <div class="de-ProductCarousel de-ProductCarousel--large">
          {% include 'product-carousel' %}
        </div>
        <div class="ProductBuyBox">
          {% include 'product-proto-buybox' %}
        </div>
      </div>
    </div>
  </section>

  {% if product_video.size > 0 %}
  <section class="de-ProductInfoSection de-ProductInfoSection--silver
                  de-u-md-pad"
           aria-labelledby="Section-videos">
    <header>
      <h3 class="de-ProductInfoTitle de-u-md-textGrow3 de-u-lg-textGrow4
                de-u-spaceNone de-u-hidden de-u-md-inlineBlock"
          id="Section-videos">
        <span class="visually-hidden">Product</span> Videos
      </h3>
    </header>
    <div class="Accordion js-Accordion is-open">
      <button class="Accordion-header js-Accordion-header de-u-textGrow2">
        Additional Videos
        <span class="Accordion-indicator de-u-textGrow5 de-u-spaceRight06">
          +
        </span>
      </button>
      <div class="Accordion-content">
        {% include 'product-videos' %}
      </div>
    </div>
  </section>
  {% endif %}

  <section class="de-ProductInfoSection de-u-md-pad2"
           aria-labelledby="Section-features">
    <header>
      <h3 class="de-ProductInfoTitle de-u-md-textGrow3 de-u-lg-textGrow4
                de-u-spaceNone de-u-hidden de-u-md-inlineBlock"
          id="Section-features">
        <span class="visually-hidden">Product</span> Features
      </h3>
    </header>
    <div class="Accordion js-Accordion is-open">
      <button class="Accordion-header js-Accordion-header de-u-textGrow2">
        Features
        <span class="Accordion-indicator de-u-textGrow5 de-u-spaceRight06">
          +
        </span>
      </button>
      <div class="Accordion-content">
        {% include 'product-proto-features' %}
      </div>
    </div>
  </section>

  <section class="de-ProductInfoSection de-ProductInfoSection--silver
                  de-u-md-pad"
           aria-labelledby="Section-lifestyle-images">
    <h3 class="de-ProductInfoTitle de-u-md-textGrow3 de-u-lg-textGrow4
               de-u-spaceNone de-u-hidden de-u-md-inlineBlock"
        id="Section-lifestyle-images">
      <span class="visually-hidden">Product Lifestyle</span> Image Gallery
    </h3>
    <div class="Accordion js-Accordion is-open">
      <button class="Accordion-header js-Accordion-header de-u-textGrow2">
        Image Gallery
        <span class="Accordion-indicator de-u-textGrow5 de-u-spaceRight06">
          +
        </span>
      </button>
      <div class="Accordion-content">
        {% include 'product-carousel-context' %}
      </div>
    </div>
  </section>

  <section class="de-ProductInfoSection
                  de-u-md-padEnds de-u-md-padSides de-u-md-hidden"
           aria-labelledby="Section-sizeguide">
    <header>
      <h3 class="visually-hidden" id="Section-sizeguide">
        Product Size and Fit Information
      </h3>
    </header>
    <div class="Accordion js-Accordion">
      <button class="Accordion-header js-Accordion-header de-u-textGrow2">
        Size & Fit
        <span class="Accordion-indicator de-u-textGrow5 de-u-spaceRight06">
          +
        </span>
      </button>
      <div class="Accordion-content">
        <div class="de-u-flex de-u-flexJustifyCenter">
          <img
            src="https://cdn.shopify.com/s/files/1/1330/6287/files/sizechart-womens-top-size-by-size_300x.jpg"
            alt="">
        </div>
        <div class="SizeGuide">
          <h5 class="de-u-padEnds de-u-spaceNone">
            Size Guide
          </h5>
          <div class="SizeGuide-table de-Wrapper--fullwidth de-u-flex
                      de-u-padBottom3">
            {% include 'product-proto-size-guide' %}
          </div>
          <p class="de-u-padEnds06">1. Footnote</p>
        </div>
      </div>
    </div>
  </section>

  <section class="de-ProductInfoSection
                  de-u-md-padEnds de-u-md-padSides
                  js-de-Reviews"
           aria-labelledby="Section-reviews"
           data-model-code="{{model_code}}">
    <header>
      <h3 class="de-ProductInfoTitle de-u-md-textGrow3 de-u-lg-textGrow4
                de-u-spaceNone de-u-hidden de-u-md-inlineBlock"
          id="Section-reviews">
        <span class="visually-hidden">Product </span>Customer Reviews
      </h3>
    </header>
    <div class="Accordion js-Accordion is-open">
      <button class="Accordion-header js-Accordion-header de-u-textGrow2">
        Customer Reviews
        <span class="Accordion-indicator de-u-textGrow5 de-u-spaceRight06">
          +
        </span>
      </button>
      <div class="Accordion-content">
        {% comment %}
          Customer Reviews Prototype Markup
          {% include 'product-proto-customer-reviews' %}
        {% endcomment %}
        {% comment %} Dynamic Customer Reviews {% endcomment %}
        {% include 'product-customer-reviews' %}
      </div>
    </div>
  </section>

  <section class="de-ProductInfoSection
                  de-ProductInfoSection--silver de-u-md-pad"
           aria-labelledby="Section-additional-info">
    <header>
      <h3 class="de-ProductInfoTitle de-u-md-textGrow3 de-u-lg-textGrow4
                de-u-spaceNone de-u-hidden de-u-md-inlineBlock"
          id="Section-additional-info">
        <span class="visually-hidden">Additional </span>Product Information
      </h3>
    </header>
    <div class="Accordion Accordion--last js-Accordion">
      <button class="Accordion-header js-Accordion-header de-u-textGrow2">
        Product Information
        <span class="Accordion-indicator de-u-textGrow5 de-u-spaceRight06">
          +
        </span>
      </button>
      <div class="Accordion-content" itemprop="description">
        {% comment %}
          Dynamic Product information content
        {% endcomment %}
        {% comment %} {{ product_specs }} {% endcomment %}
        {% comment %}
         Prototype product information content
        {% endcomment %}
        <div class="de-u-spaceTop6">
          {% include 'product-proto-information' %}
        </div>
      </div>
    </div>
  </section>

</div>

{% include 'product-single-timber' %}

{% comment %}
<div class="product-description rte" itemprop="description">
  {{ product_intro }}
</div>
{% endcomment %}

{% comment %}
<div class="addons-list">
  <a class="u-textBold u-marginBottom0x">Included:</a>
  <small class="addons-list__items"></small>
</div>
{% endcomment %}

{% comment %}
  {% include 'product-detail--collection-control' %}
{% endcomment %}

{% comment %}
  To take advantage of a callback on the select dropdown, add option_selection.js
  and customize the JS in timber.productPage as needed.

  Currently, timber.productPage does the following:
    - Hides your <select> tag from above
    - Breaks out the product variants into separate product options, if more than one exists
    - Generates a <select> tag for each product option
    - Enables/disables elements based on variant availability

  Callback notes:
    - Keep the callback available to the global scope (window.selectCallback) so that advanced
      addons can override it.
      * E.g. multiple currencies http://docs.shopify.com/manual/configuration/store-customization/currencies-and-translations/currencies/how-to-toggle-between-two-currencies
{% endcomment %}

{{ 'option_selection.js' | shopify_asset_url | script_tag }}

{% comment %}
  From Shopify Timber Product template START BLOCK 2
{% endcomment %}
<script>
  var productJSON = {{ product | json }},
      colorOption = null,
      selectCallbackInitialized = false,
      activeColor;

  productJSON.rating = '{{ product.metafields.ratings.product_rating }}';

  for(option in productJSON.options) {
    if (productJSON.options[option] === 'Color') {
      colorOption = 'option'+ (parseInt(option) + 1);
    }
  }

  var selectCallback = function(variant, selector) {
    timber.productPage({
      money_format: "{{ shop.money_format }}",
      variant: variant,
      selector: selector
    });
  };

  {% comment %} jQuery(function($) {
    new Shopify.OptionSelectors('productSelect', {
      product: {{ product | json }},
      onVariantSelected: selectCallback,
      enableHistoryState: true
    });

    // Add label if only one product option and it isn't 'Title'. Could be 'Size'.
    {% if product.options.size == 1 and product.options.first != 'Title' %}
      $('.selector-wrapper:eq(0)').prepend('<label for="productSelect-option-0">{{ product.options.first | escape }}</label>');
    {% endif %}

    // Hide selectors if we only have 1 variant and its title contains 'Default'.
    {% if product.variants.size == 1 and product.variants.first.title contains 'Default' %}
      $('.selector-wrapper').hide();
    {% endif %}
  }); {% endcomment %}
</script>
{% comment %}
  From Shopify Timber Product template END BLOCK 2
{% endcomment %}

{% comment %}
  From existing Decathlon Product template START BLOCK 4
{% endcomment %}
{% include 'sizechart' %}
{% comment %}
  From existing Decathlon Product template END BLOCK 4
{% endcomment %}
